<h1 mat-dialog-title> Edit Widget </h1>

<form [formGroup]="form">
  <div mat-dialog-content *ngIf="itemGroupsDataSource | async; let dataSource">
    <div class="config-option">
      <div class="label"> Title </div>
      <div class="option">
        <input class="theme-border" matInput formControlName="title">
      </div>
    </div>

    <div class="config-option">
      <div class="label"> Type </div>
      <div class="option">
        <mat-button-toggle-group formControlName="displayType">
          <mat-button-toggle *ngFor="let displayType of displayTypes"
                             [value]="displayType.id">
            {{displayType.label}}
          </mat-button-toggle>
        </mat-button-toggle-group>
      </div>
    </div>

    <widget-type-options [type]="form.value.displayType"
                         [options]="displayTypeOptions"
                         [itemGroupsDataSource]="dataSource"
                         (optionsChanged)="displayTypeOptions = $event">
    </widget-type-options>

    <div class="config-option">
      <div class="label"> Query Type </div>
      <div class="option">
        <mat-button-toggle-group [value]="dataSourceType | async"
                                 (change)="dataSourceType.next($event.value)">
          <mat-button-toggle value="issue"> Issue </mat-button-toggle>
          <mat-button-toggle value="pr">Pull Request</mat-button-toggle>
        </mat-button-toggle-group>
      </div>
    </div>

    <div class="config-option">
      <div class="label query">
        Query
        <button mat-icon-button [matMenuTriggerFor]="loadSearch" type="button"
                matTooltip="Load from saved searches">
          <mat-icon> save_alt </mat-icon>
        </button>
      </div>
      <div class="option">
        <advanced-search [filterer]="dataSource?.filterer">
        </advanced-search>
      </div>
    </div>
  </div>

  <div mat-dialog-actions align="end">
    <button mat-button mat-dialog-close> Cancel </button>
    <button mat-raised-button (click)="edit()" color="primary" cdkFocusInitial>
      Save </button>
  </div>
</form>

<mat-menu #loadSearch="matMenu">
  <button mat-menu-item *ngIf="(recommendationsList | async)?.length > 0"
          [matMenuTriggerFor]="recommendationsMenu"> Recommendations
  </button>
  <button mat-menu-item
          *ngIf="(issueQueries | async)?.length > 0 && form.value.dataSourceType === 'issue'"
          [matMenuTriggerFor]="issueQueriesMenu"> Issue Queries
  </button>
  <button mat-menu-item
          *ngIf="(prQueries | async)?.length > 0 && form.value.dataSourceType === 'pr'"
          [matMenuTriggerFor]="prQueriesMenu"> Pull Request Queries
  </button>
</mat-menu>

<mat-menu #recommendationsMenu="matMenu">
  <button mat-menu-item
          *ngFor="let recommendation of recommendationsList | async"
          (click)="loadFromRecommendation(recommendation)">
    {{recommendation.message}}
  </button>
</mat-menu>

<mat-menu #issueQueriesMenu="matMenu">
  <button mat-menu-item *ngFor="let query of issueQueries | async"
          (click)="loadFromQuery(query)">
    {{query.name}}
  </button>
</mat-menu>

<mat-menu #prQueriesMenu="matMenu">
  <button mat-menu-item *ngFor="let query of prQueries | async"
          (click)="loadFromQuery(query)">
    {{query.name}}
  </button>
</mat-menu>
